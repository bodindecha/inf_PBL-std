const PBL=function(e){let a={API_URL:"/s/PBL/v2/api/",USER:top.USER,HTML:{"tab-menu":(e,a,t)=>'<div class="tab" data-page="'+e+'" onClick="PBL.openPage(this)"><div class="face"><i class="material-icons">'+t+"</i><span>"+a+'</span></div><div class="pop-label"><span>'+a+"</span></div></div>",timeline(e,a){if(!a.sem)return'</div><br><p>ภาคเรียนที่ 2</p><div class="progress slider">';e=e.toString();var t='<div class="sec sec-'+a.deadline+'"><div class="disp" data-title="'+a.title+'"><span class="line"></span><label>'+e+'</label></div><p>กำหนดส่งภายใน</p><output deadline="'+a.deadline+'"></output><div class="asgmt-list">';return Object.keys(a.works).forEach(e=>{t+='<div class="work"><i class="material-icons" work="'+e+'"></i><label>'+a.works[e]+"</label></div>"}),t+="</div></div>"},"work-act":e=>'<button class="blue icon" onClick="PBL.upload(\''+e+'\')" data-title="Replace with new file"><i class="fa fa-upload"></i></button><button class="gray icon" onClick="PBL.file.preview(\''+e+'\')" data-title="View file"><i class="material-icons">visibility</i></button><button class="yellow icon" onClick="PBL.file.print(\''+e+'\')" data-title="Print file"><i class="material-icons">print</i></button><button class="green icon" onClick="PBL.file.download(\''+e+'\')" data-title="Download file"><i class="material-icons">download</i></button><button class="red icon" onClick="PBL.file.remove(\''+e+'\')" data-title="Remove file"><i class="material-icons">delete</i></button>'},tab_menu:{ng:[["group/new","Create","library_add"],["group/join","Join","exit_to_app"]],hg:[["schedule","Schedule","schedule"],["group/information","Information","library_books"],["group/members","Members","group"],["file/documents","Documents","folder"],["file/assignment","Submit work","assignment"],["comments","Comments","comment"]]},timeline:[{isPBL:!0,title:"การจัดกลุ่ม",deadline:"A",works:{n1:"ชื่อโครงงาน",n2:"ครูที่ปรึกษา",n3:"สาขาโครงงาน"},sem:1},{isPBL:!0,title:"ส่งผังความคิด",deadline:"B",works:{mindmap:"ผังความคิดบูรณาการ 8 กลุ่มสาระการเรียนรู้"},sem:1},{isPBL:!1,title:"ส่งใบงาน IS",deadline:"C",works:{"IS1-1":"IS1-1 ประเด็นที่สนใจ","IS1-2":"IS1-2 ปัญหาเกี่ยวกับประเด็นที่สนใจ","IS1-3":"IS1-3 สมมติฐานที่เกี่ยวข้อง"},sem:1},{isPBL:!0,title:"ส่งบทที่ 1-3",deadline:"D",works:{"report-1":"รายงานโครงงานบทที่ 1","report-2":"รายงานโครงงานบทที่ 2","report-3":"รายงานโครงงานบทที่ 3"},sem:1},{sem:0},{isPBL:!0,title:"ส่งบทที่ 4-5",deadline:"E",works:{"report-4":"รายงานโครงงานบทที่ 4","report-5":"รายงานโครงงานบทที่ 5"},sem:2},{isPBL:!0,title:"ส่งเล่มเต็มและอื่นๆ",deadline:"F",works:{"report-all":"รวมเล่มรายงานโครงงาน",abstract:"บทคัดย่อโครงงาน"},sem:2},{isPBL:!0,title:"ส่งโปสเตอร์",deadline:"G",works:{poster:"โปสเตอร์"},sem:2},],MSG:{"delete-group":"Are you sure you want to delete this group and its progress (all your work) ?\nThis action can't be undone.","delete-mbr":"Are you sure you want to delete this member?\nThis action can't be undone.",newLeader:"Are you sure you want to set your friend as the new group leader?\nThis action can't be undone.","del-work":e=>'Are you sure you want to delete group "'+e+"\" file?\nThis action can't be undone."},workload:{mindmap:"แผนผังความคิดบูรณาการ 8 กลุ่มสาระการเรียนรู้","IS1-1":"ใบงาน IS1-1 (ประเด็นที่ต้องการศึกษา)","IS1-2":"ใบงาน IS1-2 (การระบุปัญหา)","IS1-3":"ใบงาน IS1-3 (การระบุสมมติฐาน)","report-1":"เล่มรายงานโครงงานบทที่ 1","report-2":"เล่มรายงานโครงงานบทที่ 2","report-3":"เล่มรายงานโครงงานบทที่ 3","report-4":"เล่มรายงานโครงงานบทที่ 4","report-5":"เล่มรายงานโครงงานบทที่ 5","report-all":"รวมเล่มรายงานโครงงาน (ฉบับเต็ม)",abstract:"บทคัดย่อโครงงาน",poster:"โปสเตอร์"},mbr_settings:["statusOpen","publishWork"]};var t={started:!1,HTML:{},current:{page:"",workType:""},state:{button_freeze:!1,loadInfoOver:!0,loadSettingsOver:!0},notifyJsInited:!1,history:{unsavedPage:[]}},n={freeze:function(){$("main .pages .page.current button, main .tab-selector").attr("disabled",""),t.state.button_freeze=!0},unfreeze:function(){t.state.button_freeze&&($("main .pages .page.current button, main .tab-selector").removeAttr("disabled"),t.state.button_freeze=!1,"group/information"===t.current.page&&(t.state.loadInfoOver=!1,v(t.current.page)))}},i=function(){t.notifyJsInited||(t.notifyJsInited=!0,$.notify.addStyle("PBL-unsaved",{html:'<div><div class="clearfix"><div class="title" data-notify-html="title"></div><div class="form inline"><button class="yellow" name="keep">Keep unsaved changes</button><button class="red hollow" name="load">Load updates</button></div></div></div>'}),$(document).on("click",'main .notifyjs-PBL-unsaved-base [name="keep"]',function(){$(this).trigger("notify-hide")}),$(document).on("click",'main .page[path="group/information"] .notifyjs-PBL-unsaved-base [name="load"]',function(){m(),$(this).trigger("notify-hide")}),$(document).on("click",'main .page[path="group/members"] .notifyjs-PBL-unsaved-base [name="load"]',function(){t.isLeader&&($('main .page[path^="group/"] .settings [onClick^="PBL.save.settings"]').attr("disabled",""),a.mbr_settings.forEach(a=>{e.querySelector('main .page[path^="group/"] .settings [name="'+a+'"]').checked="Y"==t.groupSettings[a]}),t.state.loadSettingsOver=!0,b("group/members")),$(this).trigger("notify-hide")}))},o=async function(){await ajax(a.API_URL+"status",{type:"get",act:"personal"}).then(function(e){let a=r(e.isGrouped,"render");t.status=e,t.code=e.code,s(a)})},r=function(e=null,a=null){var t=location.hash.substring(2),n=[null];if(t.length){var i=t.split("/");!1==e?"group/new"==t?n=[t]:"group/join"==t?n=[t,null]:/^group\/join\/[A-Z0-9]{6}$/.test(t)&&(n=["group/join",i[2]]):!0==e&&/^(schedule|group\/(information|members)|file\/(documents|assignment)|comments)$/.test(t)&&(n=[t])}return n},s=function(e){null==e[1]&&e[2]>=0&&(t.status={isGrouped:!1},t.code=null);var n=t.status.isGrouped?"h":"n";$("main > .container").html(t.HTML["header-bar"]).append('<div class="wrapper tab-selector"><div class="tabs"></div></div>').append('<section class="pages"></section>');var i=$("main > .container .tab-selector .tabs").css("--tab-count",a.tab_menu[n+"g"].length);a.tab_menu[n+"g"].forEach(e=>i.append(a.HTML["tab-menu"](...e))),null==e[0]&&(e[0]=t.status.isGrouped?"schedule":"group/join"),$("main > .container .pages").load("/s/PBL/v2/blocks.html .pages[page-type="+n+"g]",function(){$("main > .container > .pages").html($("main > .container .pages > .pages").html()),"h"==n&&(l("schedule","block"),l("file/documents","checkIS"),l("file/assignment","readyTable"),chatApp.start("std",[t.code],!0),t.chatInit=!1),PBL.openPage(e[0],e)})},l=function(e,...n){switch(e){case"group/new":break;case"group/join":null==n[0]||"group/join"==n[0]?$('main .page[path="group/join"] [name="gjc"]').focus():n[0].length&&($('main .page[path="group/join"] [name="gjc"]').val(n[0]),$('main .page[path="group/join"] button').focus());break;case"schedule":if("block"==n[0]){var i=1,o="";a.timeline.forEach(e=>{(!e.sem||e.isPBL||!e.isPBL&&t.status.requireIS)&&(o+=a.HTML.timeline(i++,e),!e.sem&&i--)}),$('main .page[path="schedule"]').prepend('<div class="progress slider">'+o+"</div>").prepend("<p>ภาคเรียนที่ 1</p>")}else p();break;case"group/information":t.state.loadInfoOver?m():$('main .page[path="group/information"] .form').notify({title:"You have unsaved changes."},{className:"warning",elementPosition:"bottom right",autoHideDelay:6e4,clickToHide:!1,style:"PBL-unsaved"}),t.state.button_freeze=!0;break;case"group/members":$('main .page[path="group/members"] .code output[name="gjc"]').val(t.code),g();break;case"file/documents":"checkIS"==n[0]&&(t.status.requireIS||$('main .page[path="file/documents"] .files tr.isInIS').remove(),$('main .page[path="file/documents"] .files .act-group a[download]').attr("draggable","false"),isSafari&&$('main .page[path="file/documents"] .files .act-group a[download]').attr("target","_blank"),$('main .page[path="file/documents"] a:not([download])').attr("target","_blank").attr("draggable","false").each((e,a)=>{let t="/go?url="+encodeURIComponent(a.href);a.href=t}));break;case"file/assignment":if("readyTable"==n[0]){var r="";Object.keys(a.workload).forEach(e=>{(t.status.requireIS||"IS"!=e.substr(0,2))&&(r+='<tr><td><span class="--txtoe">'+a.workload[e]+'</span></td><td><div class="group center" data-work="'+e+'">',r+='</div></td><td center><output name="'+e+'"></output></td></tr>')}),$('main .page[path="file/assignment"] .work tbody').html(r)}else d();break;case"comments":t.chatInit||(t.chatInit=!0,chatApp.init(!0))}},u=function(e){void 0!==e.message&&e.message.forEach(e=>app.ui.notify(1,e)),e.isGrouped&&(t.status=e,t.code=e.code,s([null]))},p=async function(){await ajax(a.API_URL+"status",{type:"work",act:"deadline"}).then(function(e){e?Object.keys(e).forEach(a=>{$('main .page[path="schedule"] output[deadline="'+a+'"]').val(e[a][0])}):$('main .page[path="schedule"] output[deadline]').val("ไม่พบข้อมูล"),t.deadlines=e}),await d().then(function(){var e=Date.now(),n=!1;t.workStatus?a.timeline.forEach(a=>{if(a.sem&&(a.isPBL||!a.isPBL&&t.status.requireIS)){var i=!0,o="p",r=new Date(t.deadlines[a.deadline][1]).getTime();Object.keys(a.works).forEach(e=>{i=i&&t.workStatus[e]}),e>r?o=i?"e":"m":n?o=i?"i":"p":(o=i?"e":"s",c(a.deadline)&&(n=!n)),$('main .page[path="schedule"] .sec-'+a.deadline+" .disp").attr("class","disp "+o)}}):$('main .page[path="schedule"] .sec .disp').attr("class","disp p")}).then(function(){if(t.deadlines,t.workStatus){t.status.requireIS||Object.keys(a.workload).forEach(e=>{/^IS\d-\d$/.test(e)&&delete t.workStatus[e]});var e=Object.keys(t.workStatus).length,n=100*Object.values(t.workStatus).filter(e=>e).length;n=n%e?Math.round(n/e*100)/100:n/e,$('main .page[path="schedule"] output[name="progress"]').val(n)}})},d=async function(){await ajax(a.API_URL+"status",{type:"work",act:"file"}).then(function(e){e?($('main .page[path="schedule"] .asgmt-list .work i').each((a,t)=>{var n=e[t.getAttribute("work")];$(t).attr("class","material-icons "+(n?"g":"r")).text(n?"done":"clear")}),Object.keys(e).forEach(t=>{if(!/^n\d+$/.test(t)){$('main .page[path="file/assignment"] .work output[name="'+t+'"]').attr("class",e[t]?"y":"n").val(e[t]?"ส่งแล้ว":"ไม่มีไฟล์");var n=e[t]?a.HTML["work-act"](t):'<button class="blue hollow icon" onClick="PBL.upload(\''+t+'\')"><i class="material-icons">add_circle</i>Upload attatchment</button>';$('main .page[path="file/assignment"] .work [data-work="'+t+'"]').html(n).attr("class","group center"+(e[t]?" action":""))}})):sys.auth.orize(!0,!0),t.workStatus=e})},c=function(e){var a=Object.keys(t.deadlines),n=t.deadlines[a[a.indexOf(e)+1]];return void 0===n||t.deadlines[e][1]<n[1]},m=async function(){await ajax(a.API_URL+"information",{type:"group",act:"title"}).then(async function(e){if(void 0===e.isGrouped||e.isGrouped){e.score?($('main .page[path="group/information"] .score').fadeIn(),$('main .page[path="group/information"] [name="net"]').text(e.score).attr("class","color-"+" rrrog".split("")[e.score])):($('main .page[path="group/information"] .score').fadeOut(),$('main .page[path="group/information"] [name="net"]').text("").removeAttr("class")),delete e.score,Object.keys(e).forEach(a=>$('main .page[path="group/information"] [name="'+a+'"]').val(e[a]||"")),t.state.loadInfoOver=!0,b(t.current.page);var n=[e.adv1,e.adv2,e.adv3].filter(e=>null!=e);if(n.length)await ajax(a.API_URL+"information",{type:"person",act:"teacher",param:n.join(",")}).then(function(e){Object.keys(e.list).forEach(a=>$('main .page[path="group/information"] [name="adv'+(n.indexOf(a)+1).toString()+'"] + input').val(e.list[a]));for(let a=Object.keys(e.list).length+1;a<=3;a++)$('main .page[path="group/information"] [name="adv'+a.toString()+'"] + input').val("")});else for(let i=1;i<=3;i++)$('main .page[path="group/information"] [name="adv'+i.toString()+'"] + input').val("")}else s([null,null,0]);return e}).then(function(e){e&&$("main .pages .page.current button").attr("disabled","")})},g=async function(n=!0){await ajax(a.API_URL+"information",{type:"group",act:"member"}).then(async function(i){void 0===i.isGrouped||i.isGrouped?(await ajax(a.API_URL+"information",{type:"person",act:"student",param:i.list.join(",")}).then(function(e){var n=1,i="";t.isLeader=a.USER==e.list[0].ID,e.list.forEach(e=>{i+="<tr><td>"+n.toString()+".</td><td>"+e.fullname+' (<a href="/'+e.ID+'" target="_blank" draggable="false">'+e.nickname+"</a>)</td><td>เลขที่ "+e.number+"</td><td>",1==n++?i+='<a role="button" class="default" disabled>หัวหน้ากลุ่ม</a>':t.isLeader&&(i+='<div class="group"><button onClick="PBL.kick('+e.ID+')" class="red hollow">ลบชื่อออก</button><button onClick="PBL.setLeader('+e.ID+')" class="yellow hollow icon" data-title="Set as leader">\uD83D\uDC51</button></div>'),i+="</td></tr>"}),$('main .page[path="group/members"] .list tbody').html(i),t.isLeader?$('main .page[path="group/members"] > p button').attr("onClick","PBL.terminate(true)").attr("class","yellow").text("ลบกลุ่ม"):$('main .page[path="group/members"] > p button').attr("onClick","PBL.terminate(false)").attr("class","red").text("ออกจากกลุ่ม")}),t.isLeader?(t.groupSettings=i.settings,$('main .page[path^="group/"] .settings').fadeIn(),n&&(t.state.loadSettingsOver?($('main .page[path^="group/"] .settings [onClick^="PBL.save.settings"]').attr("disabled",""),a.mbr_settings.forEach(a=>{e.querySelector('main .page[path^="group/"] .settings [name="'+a+'"]').checked="Y"==t.groupSettings[a]}),t.state.loadSettingsOver=!0,b(t.current.page)):$('main .page[path^="group/"] .settings').notify({title:"You have unsaved changes."},{className:"warning",elementPosition:"bottom center",autoHideDelay:6e4,clickToHide:!1,style:"PBL-unsaved"}))):$('main .page[path^="group/"] .settings').fadeOut()):s([null,null,0])})},f=async function(e,n=null){e||t.isLeader&&n==a.USER?t.isLeader?confirm(a.MSG["delete-group"])&&await ajax(a.API_URL+"group",{type:"delete",act:"void"}).then(function(e){void 0!==e.message&&e.message.forEach(e=>app.ui.notify(1,e)),e&&s([null,null,1])}):app.ui.notify(1,[3,"You must be a leader to delete the group."]):confirm(a.MSG["delete-mbr"])&&await ajax(a.API_URL+"group",{type:"delete",act:"member",param:n||a.USER}).then(function(e){e&&(null!=n?(void 0!==e.message&&e.message.forEach(e=>app.ui.notify(1,e)),g(!1)):(app.ui.notify(1,[0,"You left the group."]),s([null,null,2])))})},h=function(e){f(!1,e)},v=function(e){t.history.unsavedPage.length||$(window).bind("beforeunload",function(){return t.history.unsavedPage.includes(t.current.page)||PBL.openPage(t.history.unsavedPage[t.history.unsavedPage.length-1]),null}),t.history.unsavedPage.includes(e)||t.history.unsavedPage.push(e)},b=function(e){let a=t.history.unsavedPage.indexOf(e);a>-1&&t.history.unsavedPage.splice(a,1),t.history.unsavedPage.length||app.io.confirm("unleave")};return{init:function(){if(!t.started){if(t.started=!0,!a.USER.length)return sys.auth.orize(!0,!0);t.HTML["header-bar"]=$("main > .container").html(),o(),i()}},openPage:function(a,n=[]){"string"==typeof a&&(a=e.querySelector('main .tab-selector .tab[data-page="'+a+'"]'));var i=$(a).attr("data-page");if(i==t.current.page)return!1;n.length,history.replaceState(null,null,location.pathname+location.search+"#/"+i),t.current.page=i,$("main .tab-selector .tab.active").removeClass("active"),$(a).addClass("active"),$("main .pages .page.current").removeClass("current"),$('main .pages .page[path="'+i+'"]').addClass("current"),n.length>1&&n.shift(),l(i,...n)},help:function(a=null){if(null==a)app.ui.lightbox.open("mid",{title:"ความช่วยเหลือ",allowclose:!0,autoclose:6e4,html:e.querySelector("main > .manual[hidden]").innerHTML});else{switch(a){case"document":app.ui.notify(1,[2,"Help: Manual document is currently unavailable."]);break;case"mediaVDO":app.ui.notify(1,[2,"Help: Manual video playlist is currently unavailable."]);break;default:window.open($("main > .manual[hidden] a[onClick$=\"PBL.help('"+a+"')\"]").attr("data-href"))}app.ui.lightbox.close()}},createGroup:function(e){return!async function(e){if(e){var t={nameth:$('main .page[path="group/new"] [name="nameth"]').val().trim().replaceAll("เเ","แ"),nameen:$('main .page[path="group/new"] [name="nameen"]').val().trim().replaceAll("เเ","แ"),adv1:$('main .page[path="group/new"] [name="adv1"]').val(),adv2:$('main .page[path="group/new"] [name="adv2"]').val(),adv3:$('main .page[path="group/new"] [name="adv3"]').val(),type:$('main .page[path="group/new"] [name="type"]').val()};t.nameth.length&&!/^[ก-๛0-9A-Za-z ()[\]{}\-!@#$%.,/&*+_?|]{3,150}$/.test(t.nameth)?(app.ui.notify(1,[2,"Invalid Thai project name."]),$('main .page[path="group/new"] [name="nameth"]').focus()):t.nameen.length&&!/^[A-Za-z0-9ก-๛ ()[\]{}\-!@#$%.,/&*+_?|]{3,150}$/.test(t.nameen)?(app.ui.notify(1,[2,"Invalid English project name."]),$('main .page[path="group/new"] [name="nameen"]').focus()):" ABCDEFGHIJKLM".includes(t.type)?(n.freeze(),await ajax(a.API_URL+"group",{type:"create",act:"new-group",param:t}).then(u).then(n.unfreeze)):(app.ui.notify(1,[2,"Invalid project type."]),$('main .page[path="group/new"] [name="type"]').focus())}else $('main .page[path="group/new"] input, main .page[path="group/new"] select').val("")}(e),!1},joinGroup:function(){return!async function(){var e=$('main .page[path="group/join"] [name="gjc"]').val().trim().toUpperCase();e.length?/^[A-Z0-9]{6}$/.test(e)?(n.freeze(),await ajax(a.API_URL+"group",{type:"join",act:"existing-group",param:e}).then(u).then(n.unfreeze)):(app.ui.notify(1,[2,"Invalid group code."]),$('main .page[path="group/join"] [name="gjc"]').focus()):(app.ui.notify(1,[2,"Group code empty."]),$('main .page[path="group/join"] [name="gjc"]').focus())}(),!1},terminate:f,kick:h,setLeader:async function(e){e==a.USER?app.ui.notify(1,t.isLeader?[1,"You are already a group leader."]:[2,"You can't promote yourself as a group leader."]):confirm(a.MSG.newLeader)&&await ajax(a.API_URL+"group",{type:"update",act:"leader",param:e}).then(function(e){e&&(void 0!==e.message&&e.message.forEach(e=>app.ui.notify(1,e)),g(!0))})},upload:function(e){if(!1==e){PBL.save.file(!1);return}t.current.workType=e,app.ui.lightbox.open("mid",{allowclose:!0,html:'<iframe src="upload" style="width:90vw;height:712px;border:none">Loading...</iframe>'})},save:{info:function(){return!async function(){var e={nameth:$('main .page[path="group/information"] [name="nameth"]').val().trim().replaceAll("เเ","แ"),nameen:$('main .page[path="group/information"] [name="nameen"]').val().trim().replaceAll("เเ","แ"),adv1:$('main .page[path="group/information"] [name="adv1"]').val(),adv2:$('main .page[path="group/information"] [name="adv2"]').val(),adv3:$('main .page[path="group/information"] [name="adv3"]').val(),type:$('main .page[path="group/information"] [name="type"]').val()};e.nameth.length&&!/^[ก-๛0-9A-Za-z ()[\]{}\-!@#$%.,/&*+_?|]{3,150}$/.test(e.nameth)?(app.ui.notify(1,[2,"Invalid Thai project name."]),$('main .page[path="group/information"] [name="nameth"]').focus()):e.nameen.length&&!/^[A-Za-z0-9ก-๛ ()[\]{}\-!@#$%.,/&*+_?|]{3,150}$/.test(e.nameen)?(app.ui.notify(1,[2,"Invalid English project name."]),$('main .page[path="group/information"] [name="nameen"]').focus()):" ABCDEFGHIJKLM".includes(e.type)?(n.freeze(),await ajax(a.API_URL+"group",{type:"update",act:"information",param:e}).then(function(e){void 0===e.isGrouped||e.isGrouped?void 0!==e.message&&e.message.forEach(e=>app.ui.notify(1,e)):s([null,null,0])}).then(n.unfreeze).then(function(){$("main .pages .page.current button").attr("disabled",""),t.state.loadInfoOver=!0,b(t.current.page)})):(app.ui.notify(1,[2,"Invalid project type."]),$('main .page[path="group/information"] [name="type"]').focus())}(),!1},settings:async function(n){if(void 0===t.groupSettings[n])app.ui.notify(1,[3,"Setting not found."]);else{var i,o=(i=n,a.mbr_settings.includes(i)?e.querySelector('main .page[path^="group/"] .settings [name="'+i+'"]').checked?"Y":"N":[null]),r=$('main .page[path^="group/"] .settings [onClick="PBL.save.settings(\''+n+"')\"]");o==[null]&&app.ui.notify(1,[3,"Error validating your setting."]),t.groupSettings[n]==o?(app.ui.notify(1,[1,"No change applies."]),r.attr("disabled","")):await ajax(a.API_URL+"information",{type:"settings",act:"member",param:[n,o]}).then(function(e){void 0!==e.message&&e.message.forEach(e=>app.ui.notify(1,e)),e&&(t.groupSettings[n]=o,r.attr("disabled",""))})}},file:function(e){app.ui.lightbox.close(),"complete"==e&&d(),t.current.workType=""}},file:{preview:function(e){app.ui.lightbox.open("mid",{title:"ไฟล์"+a.workload[e],allowclose:!0,html:'<iframe src="preview?file='+e+'" style="width:90vw;height:80vh;border:none">Loading...</iframe>'})},print:async function(e){var t=$('main .page[path="file/assignment"] .work [data-work="'+e+'"] button[onClick*="print"]');await ajax(a.API_URL+"status",{type:"get",act:"fileLink",param:e}).then(function(e){void 0===e.isGrouped||e.isGrouped?(e.print?(e.print=atob(e.print),/.+\.pdf$/.test(e.print)?printJS(e.print):printJS(e.print,"image")):app.ui.notify(1,[3,"There's a problem preparing your file for print."]),setTimeout(function(){t.removeAttr("disabled")},500)):s([null,null,0])}),t.attr("disabled","")},download:async function(t){var n=$('main .page[path="file/assignment"] .work [data-work="'+t+'"] button[onClick*="download"]');await ajax(a.API_URL+"status",{type:"get",act:"fileLink",param:t}).then(function(a){void 0===a.isGrouped||a.isGrouped?a.download?(e.querySelector('main iframe[name="dlframe"]').src=a.download,setTimeout(function(){n.removeAttr("disabled")},5e3)):(n.removeAttr("disabled"),app.ui.notify(1,[3,"There's a problem downloading your file."])):s([null,null,0])}),n.attr("disabled","")},remove:async function(e){if(confirm(a.MSG["del-work"](a.workload[e]))){var t=$('main .page[path="file/assignment"] .work [data-work="'+e+'"] button[onClick*="remove"]');await ajax(a.API_URL+"main",{type:"work",act:"remove",param:e}).then(function(e){void 0===e.isGrouped||e.isGrouped?e||t.removeAttr("disabled"):s([null,null,0]),d()}),t.attr("disabled","")}}},btnAction:n,groupCode:()=>t.code,pageURL:()=>t.current.page,uploadType:()=>t.current.workType,setState:(e,a)=>t.state[e]=a,confirmLeave:v}}(document);top.PBL=PBL;